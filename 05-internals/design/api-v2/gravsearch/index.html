
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../../../assets/images/dasch-favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.4">
    
    
      
        <title>Gravsearch Design - Knora Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.358818c7.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.f0267088.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../../assets/style/theme.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gravsearch-design" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../../.." title="Knora Documentation" class="md-header-nav__button md-logo" aria-label="Knora Documentation">
      
  <img src="../../../../assets/images/dasch-icon-white.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Knora Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Gravsearch Design
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../../.." class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../01-introduction/" class="md-tabs__link">
          Introduction
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../02-knora-ontologies/" class="md-tabs__link">
          Knora Ontologies
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../03-apis/" class="md-tabs__link">
          APIs
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../04-publishing-deployment/" class="md-tabs__link">
          Publishing and Deployment
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../principles/" class="md-tabs__link">
          Knora Internals
        </a>
      
    </li>
  

  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../06-salsah/" class="md-tabs__link">
          Salsah
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../07-sipi/" class="md-tabs__link">
          SIPI
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../08-lucene/" class="md-tabs__link">
          Lucene
        </a>
      
    </li>
  

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../00-release-notes/" class="md-tabs__link">
          Release Notes
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Knora Documentation" class="md-nav__button md-logo" aria-label="Knora Documentation">
      
  <img src="../../../../assets/images/dasch-icon-white.svg" alt="logo">

    </a>
    Knora Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Introduction
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Introduction" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../01-introduction/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../01-introduction/what-is-knora/" class="md-nav__link">
      What is Knora?
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../01-introduction/data-formats/" class="md-nav__link">
      Data Formats in Knora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../01-introduction/standoff-rdf/" class="md-nav__link">
      Standoff/RDF Text Markup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../01-introduction/example-project/" class="md-nav__link">
      An Example Project
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Knora Ontologies
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Knora Ontologies" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Knora Ontologies
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../02-knora-ontologies/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../02-knora-ontologies/introduction/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../02-knora-ontologies/knora-base/" class="md-nav__link">
      The Knora Base Ontology
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../02-knora-ontologies/salsah-gui/" class="md-nav__link">
      The SALSAH GUI Ontology
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      APIs
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="APIs" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      The Knora APIs
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="The Knora APIs" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon"></span>
        The Knora APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      API V1
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API V1" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        <span class="md-nav__icon md-icon"></span>
        API V1
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/introduction/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/authentication/" class="md-nav__link">
      Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/reading-and-searching-resources/" class="md-nav__link">
      Reading and Searching Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/xml-to-standoff-mapping/" class="md-nav__link">
      XML to Standoff Mapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/adding-resources/" class="md-nav__link">
      Adding Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/reading-and-searching-resources/" class="md-nav__link">
      Reading and Searching Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/reading-values/" class="md-nav__link">
      Reading Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/adding-values/" class="md-nav__link">
      Adding Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/changing-values/" class="md-nav__link">
      Changing Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v1/delete-resources-and-values/" class="md-nav__link">
      Deleting Resources and Values
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      API V2
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API V2" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        <span class="md-nav__icon md-icon"></span>
        API V2
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/introduction/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/authentication/" class="md-nav__link">
      Authentication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/knora-iris/" class="md-nav__link">
      Knora IRIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/reading-and-searching-resources/" class="md-nav__link">
      Reading and Searching Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/reading-user-permissions/" class="md-nav__link">
      Reading the User's Permissions on Resources and Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/getting-lists/" class="md-nav__link">
      Getting Lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/xml-to-standoff-mapping/" class="md-nav__link">
      XML to Standoff Mapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/query-language/" class="md-nav__link">
      Gravsearch - Virtual Graph Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/editing-resources/" class="md-nav__link">
      Editing Resources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/editing-values/" class="md-nav__link">
      Editing Values
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/ontology-information/" class="md-nav__link">
      Querying, Creating, and Updating Ontologies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/tei-xml/" class="md-nav__link">
      TEI/XML
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-v2/permalinks/" class="md-nav__link">
      Permalinks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Admin API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Admin API" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        <span class="md-nav__icon md-icon"></span>
        Admin API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/introduction/" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/overview/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/users/" class="md-nav__link">
      Users Endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/projects/" class="md-nav__link">
      Projects Endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/groups/" class="md-nav__link">
      Groups Endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/lists/" class="md-nav__link">
      Lists Endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/permissions/" class="md-nav__link">
      Permissions Endpoint
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-admin/stores/" class="md-nav__link">
      Stores Endpoint
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Util API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Util API" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        <span class="md-nav__icon md-icon"></span>
        Util API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-util/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-util/health/" class="md-nav__link">
      Health
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../03-apis/api-util/version/" class="md-nav__link">
      Version
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Publishing and Deployment
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Publishing and Deployment" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Publishing and Deployment
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../04-publishing-deployment/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../04-publishing-deployment/publishing/" class="md-nav__link">
      Publishing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../04-publishing-deployment/getting-started/" class="md-nav__link">
      Getting Started with Knora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../04-publishing-deployment/configuration/" class="md-nav__link">
      Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../04-publishing-deployment/updates/" class="md-nav__link">
      Updating Repositories when Upgrading Knora
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Knora Internals
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Knora Internals" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Knora Internals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1" type="checkbox" id="nav-6-1" checked>
    
    <label class="md-nav__link" for="nav-6-1">
      Design
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Design" data-md-level="2">
      <label class="md-nav__title" for="nav-6-1">
        <span class="md-nav__icon md-icon"></span>
        Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-1" type="checkbox" id="nav-6-1-1">
    
    <label class="md-nav__link" for="nav-6-1-1">
      Knora Design Principles
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Knora Design Principles" data-md-level="3">
      <label class="md-nav__title" for="nav-6-1-1">
        <span class="md-nav__icon md-icon"></span>
        Knora Design Principles
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/design-overview/" class="md-nav__link">
      Design Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/futures-with-akka/" class="md-nav__link">
      Futures with Akka
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/http-module/" class="md-nav__link">
      HTTP Module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/store-module/" class="md-nav__link">
      Store Module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/triplestore-updates/" class="md-nav__link">
      Triplestore Updates
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/consistency-checking/" class="md-nav__link">
      Consistency Checking
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../principles/authentication/" class="md-nav__link">
      Authentication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-2" type="checkbox" id="nav-6-1-2">
    
    <label class="md-nav__link" for="nav-6-1-2">
      API V1 Design
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API V1 Design" data-md-level="3">
      <label class="md-nav__title" for="nav-6-1-2">
        <span class="md-nav__icon md-icon"></span>
        API V1 Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api-v1/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api-v1/how-to-add-a-route/" class="md-nav__link">
      How to Add an API v1 Route
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api-v1/json/" class="md-nav__link">
      JSON in API v1
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-3" type="checkbox" id="nav-6-1-3" checked>
    
    <label class="md-nav__link" for="nav-6-1-3">
      API V2 Design
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API V2 Design" data-md-level="3">
      <label class="md-nav__title" for="nav-6-1-3">
        <span class="md-nav__icon md-icon"></span>
        API V2 Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../overview/" class="md-nav__link">
      API v2 Design Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ontology-schemas/" class="md-nav__link">
      Ontology Schemas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../smart-iris/" class="md-nav__link">
      Smart IRIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../content-wrappers/" class="md-nav__link">
      Content Wrappers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../how-to-add-a-route/" class="md-nav__link">
      How to Add an API v2 Route
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../json-ld/" class="md-nav__link">
      JSON-LD Parsing and Formatting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ontology-management/" class="md-nav__link">
      Ontology Management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../sipi/" class="md-nav__link">
      Knora and Sipi
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Gravsearch Design
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Gravsearch Design
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gravsearch-package" class="md-nav__link">
    Gravsearch Package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-inspection" class="md-nav__link">
    Type Inspection
  </a>
  
    <nav class="md-nav" aria-label="Type Inspection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identifying-typeable-entities" class="md-nav__link">
    Identifying Typeable Entities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-type-inspection-pipeline" class="md-nav__link">
    The Type Inspection Pipeline
  </a>
  
    <nav class="md-nav" aria-label="The Type Inspection Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#annotationreadinggravsearchtypeinspector" class="md-nav__link">
    AnnotationReadingGravsearchTypeInspector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inferringgravsearchtypeinspector" class="md-nav__link">
    InferringGravsearchTypeInspector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-of-a-gravsearch-query" class="md-nav__link">
    Transformation of a Gravsearch Query
  </a>
  
    <nav class="md-nav" aria-label="Transformation of a Gravsearch Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-transformers" class="md-nav__link">
    Query Transformers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prequery" class="md-nav__link">
    Prequery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-query" class="md-nav__link">
    Main Query
  </a>
  
    <nav class="md-nav" aria-label="Main Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-the-main-query" class="md-nav__link">
    Generating the Main Query
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-the-main-querys-results" class="md-nav__link">
    Processing the Main Query's results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inference" class="md-nav__link">
    Inference
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../standoff/" class="md-nav__link">
      Standoff Markup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ark/" class="md-nav__link">
      Archival Resource Key (ARK) Identifiers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../query-design/" class="md-nav__link">
      SPARQL Query Design
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-1-4" type="checkbox" id="nav-6-1-4">
    
    <label class="md-nav__link" for="nav-6-1-4">
      Admin API Design
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Admin API Design" data-md-level="3">
      <label class="md-nav__title" for="nav-6-1-4">
        <span class="md-nav__icon md-icon"></span>
        Admin API Design
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api-admin/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api-admin/administration/" class="md-nav__link">
      Administration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      Development
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Development" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        <span class="md-nav__icon md-icon"></span>
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/overview/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/building-and-running/" class="md-nav__link">
      Build and Running
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/intellij-config/" class="md-nav__link">
      Setup IntelliJ for development of Knora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/bazel/" class="md-nav__link">
      Bazel Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/testing/" class="md-nav__link">
      Testing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/docker-cheat-sheet/" class="md-nav__link">
      Docker Cheat Sheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/monitoring/" class="md-nav__link">
      Monitoring Knora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/profiling/" class="md-nav__link">
      Profiling Knora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/docker-compose/" class="md-nav__link">
      Starting the Knora-Stack inside Docker Container
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/updating-repositories/" class="md-nav__link">
      Updating Repositories
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/generating-client-test-data/" class="md-nav__link">
      Generating Client Test Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development/graphdb/" class="md-nav__link">
      Starting GraphDB
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Salsah
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Salsah" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Salsah
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../06-salsah/" class="md-nav__link">
      Index
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      SIPI
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="SIPI" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        SIPI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../07-sipi/" class="md-nav__link">
      Index
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../07-sipi/setup-sipi-for-knora/" class="md-nav__link">
      Setting Up Sipi for Knora
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../07-sipi/sipi-and-knora/" class="md-nav__link">
      Interaction between Sipi and Knora
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Lucene
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Lucene" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        Lucene
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../08-lucene/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../08-lucene/lucene-query-parser-syntax/" class="md-nav__link">
      Lucene Query Parser Syntax
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../faq/" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Release Notes
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Release Notes" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon"></span>
        Release Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/migration/" class="md-nav__link">
      Migration Notes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/next/" class="md-nav__link">
      Next Release
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v1.1.0/" class="md-nav__link">
      v1.1.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v1.2.0/" class="md-nav__link">
      v1.2.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v1.3.0/" class="md-nav__link">
      v1.3.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v1.4.0/" class="md-nav__link">
      v1.4.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v1.5.0/" class="md-nav__link">
      v1.5.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v1.6.0/" class="md-nav__link">
      v1.6.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v1.7.0/" class="md-nav__link">
      v1.7.0
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v2.x.x/" class="md-nav__link">
      v2.x.x
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v3.x.x/" class="md-nav__link">
      v3.x.x
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v4.x.x/" class="md-nav__link">
      v4.x.x
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v5.x.x/" class="md-nav__link">
      v5.x.x
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../00-release-notes/v6.x.x/" class="md-nav__link">
      v6.x.x
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#gravsearch-package" class="md-nav__link">
    Gravsearch Package
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#type-inspection" class="md-nav__link">
    Type Inspection
  </a>
  
    <nav class="md-nav" aria-label="Type Inspection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#identifying-typeable-entities" class="md-nav__link">
    Identifying Typeable Entities
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-type-inspection-pipeline" class="md-nav__link">
    The Type Inspection Pipeline
  </a>
  
    <nav class="md-nav" aria-label="The Type Inspection Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#annotationreadinggravsearchtypeinspector" class="md-nav__link">
    AnnotationReadingGravsearchTypeInspector
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inferringgravsearchtypeinspector" class="md-nav__link">
    InferringGravsearchTypeInspector
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transformation-of-a-gravsearch-query" class="md-nav__link">
    Transformation of a Gravsearch Query
  </a>
  
    <nav class="md-nav" aria-label="Transformation of a Gravsearch Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#query-transformers" class="md-nav__link">
    Query Transformers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prequery" class="md-nav__link">
    Prequery
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-query" class="md-nav__link">
    Main Query
  </a>
  
    <nav class="md-nav" aria-label="Main Query">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generating-the-main-query" class="md-nav__link">
    Generating the Main Query
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processing-the-main-querys-results" class="md-nav__link">
    Processing the Main Query's results
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inference" class="md-nav__link">
    Inference
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <!---
Copyright Â© 2015-2019 the contributors (see Contributors.md).

This file is part of Knora.

Knora is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published
by the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

Knora is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public
License along with Knora.  If not, see <http://www.gnu.org/licenses/>.
-->

<h1 id="gravsearch-design">Gravsearch Design</h1>
<h2 id="gravsearch-package">Gravsearch Package</h2>
<p>The classes that process Gravsearch queries and results can be found in <code>org.knora.webapi.messages.util.search.gravsearch</code>.</p>
<h2 id="type-inspection">Type Inspection</h2>
<p>The code that converts Gravserch queries into SPARQL queries, and processes the query results, needs to know the
types of the entities that are used in the input query. As explained in
<a href="../../../../03-apis/api-v2/query-language/#type-inference">Type Inference</a>, these types can be inferred,
or they can be specified in the query using type annotations.</p>
<p>Type inspection is implemented in the package <code>org.knora.webapi.messages.util.search.gravsearch.types</code>.
The entry point to this package is <code>GravsearchTypeInspectionRunner</code>, which is instantiated by <code>SearchResponderV2</code>.
The result of type inspection is a <code>GravsearchTypeInspectionResult</code>, in which each typeable entity in the input query is
associated with a <code>GravsearchEntityTypeInfo</code>, which can be either:</p>
<ul>
<li>A <code>PropertyTypeInfo</code>, which specifies the type of object that a property is expected to have.</li>
<li>A <code>NonPropertyTypeInfo</code>, which specifies the type of a variable, or the type of an IRI representing a resource or value.</li>
</ul>
<h3 id="identifying-typeable-entities">Identifying Typeable Entities</h3>
<p>After parsing a Gravsearch query, <code>SearchResponderV2</code> calls <code>GravsearchTypeInspectionRunner.inspectTypes</code>, passing
the WHERE clause of the input query. This method first identifies the entities whose types need to be determined. Each
of these entities is represented as a <code>TypeableEntity</code>. To do this, <code>GravsearchTypeInspectionRunner</code> uses <code>QueryTraverser</code>
to traverse the WHERE clause, collecting typeable entities in a visitor called <code>TypeableEntityCollectingWhereVisitor</code>.
The entities that are considered to need type information are:</p>
<ul>
<li>All variables.</li>
<li>All IRIs except for those that represent type annotations or types.</li>
</ul>
<h3 id="the-type-inspection-pipeline">The Type Inspection Pipeline</h3>
<p><code>GravsearchTypeInspectionRunner</code> contains a pipeline of type inspectors, each of which extends <code>GravsearchTypeInspector</code>.
There are two type inspectors in the pipeline:</p>
<ul>
<li><code>AnnotationReadingGravsearchTypeInspector</code>: reads
   <a href="../../../../03-apis/api-v2/query-language/#type-annotations">type annotations</a> included in a Gravsearch query.</li>
<li><code>InferringGravsearchTypeInspector</code>: infers the types of entities from the context in which they are used, as well
  as from ontology information that it requests from <code>OntologyResponderV2</code>.</li>
</ul>
<p>Each type inspector takes as input, and returns as output, an <code>IntermediateTypeInspectionResult</code>, which
associates each <code>TypeableEntity</code> with zero or more types. Initially, each <code>TypeableEntity</code> has no types. 
Each type inspector adds whatever types it finds for each entity. </p>
<p>At the end of the pipeline, each entity should
have exactly one type. Therefore, to only keep the most specific type for an entity, 
the method <code>refineDeterminedTypes</code> refines the determined types by removing those that are base classes of others. However,
it can be that inconsistent types are determined for entities. For example, in cases where multiple resource class types 
are determined, but one is not a base class of the others. From the following statement </p>
<pre><code>{ ?document a beol:manuscript . } UNION { ?document a beol:letter .}
</code></pre>
<p>two inconsistent types can be inferred for <code>?document</code>: <code>beol:letter</code> and <code>beol:manuscript</code>.
In these cases, a sanitizer <code>sanitizeInconsistentResourceTypes</code> replaces the inconsistent resource types by 
their common base resource class (in the above example, it would be <code>beol:writtenSource</code>). </p>
<p>Lastly, an error is returned if</p>
<ul>
<li>An entity's type could not be determined. The client must add a type annotation to make the query work.</li>
<li>Inconsistent types could not be sanitized (an entity appears to have more than one type). The client must correct the query.</li>
</ul>
<p>If there are no errors, <code>GravsearchTypeInspectionRunner</code> converts the pipeline's output to a
<code>GravsearchTypeInspectionResult</code>, in which each entity is associated with exactly one type.</p>
<h4 id="annotationreadinggravsearchtypeinspector">AnnotationReadingGravsearchTypeInspector</h4>
<p>This inspector uses <code>QueryTraverser</code> to traverse the WHERE clause, collecting type annotations in a visitor called
<code>AnnotationCollectingWhereVisitor</code>. It then converts each annotation to a <code>GravsearchEntityTypeInfo</code>.</p>
<h4 id="inferringgravsearchtypeinspector">InferringGravsearchTypeInspector</h4>
<p>This inspector first uses <code>QueryTraverser</code> to traverse the WHERE clause, assembling an index of
usage information about typeable entities in a visitor called <code>UsageIndexCollectingWhereVisitor</code>. The <code>UsageIndex</code> contains,
for example, an index of all the entities that are used as subjects, predicates, or objects, along with the
statements in which they are used. It also contains sets of all the Knora class and property IRIs
that are used in the WHERE clause. <code>InferringGravsearchTypeInspector</code> then asks <code>OntologyResponderV2</code> for information
about those classes and properties, as well as about the classes that are subject types or object types of those properties.</p>
<p>Next, the inspector runs inference rules (which extend <code>InferenceRule</code>) on each <code>TypeableEntity</code>. Each rule
takes as input a <code>TypeableEntity</code>, the usage index, the ontology information, and the <code>IntermediateTypeInspectionResult</code>,
and returns a new <code>IntermediateTypeInspectionResult</code>. For example, <code>TypeOfObjectFromPropertyRule</code> infers an entity's type
if the entity is used as the object of a statement and the predicate's <code>knora-api:objectType</code> is known. For each <code>TypeableEntity</code>, 
if a type is inferred from a property, the entity and the inferred type are added to 
<code>IntermediateTypeInspectionResult.entitiesInferredFromProperty</code>.</p>
<p>The inference rules are run repeatedly, because the output of one rule may allow another rule to infer additional
information. There are two pipelines of rules: a pipeline for the first iteration of type inference, and a
pipeline for subsequent iterations. This is because some rules can return additional information if they are run
more than once on the same entity, while others cannot.</p>
<p>The number of iterations is limited to <code>InferringGravsearchTypeInspector.MAX_ITERATIONS</code>, but in practice
two iterations are sufficient for most realistic queries, and it is difficult to design a query that requires more than
six iterations.</p>
<h2 id="transformation-of-a-gravsearch-query">Transformation of a Gravsearch Query</h2>
<p>A Gravsearch query submitted by the client is parsed by <code>GravsearchParser</code> and preprocessed by <code>GravsearchTypeInspector</code>
to get type information about the elements used in the query (resources, values, properties etc.)
and do some basic sanity checks.</p>
<p>In <code>SearchResponderV2</code>, two queries are generated from a given Gravsearch query: a prequery and a main query.</p>
<h3 id="query-transformers">Query Transformers</h3>
<p>The Gravsearch query is passed to <code>QueryTraverser</code> along with a query transformer. Query transformers are classes
that implement traits supported by <code>QueryTraverser</code>:</p>
<ul>
<li><code>WhereTransformer</code>: instructions how to convert statements in the WHERE clause of a SPARQL query (to generate the prequery's Where clause).</li>
</ul>
<p>To improve query performance, this trait defines the method <code>optimiseQueryPatterns</code> whose implementation can call 
private methods to optimise the generated SPARQL. For example, before transformation of statements in WHERE clause, query 
pattern orders must be optimised by moving <code>LuceneQueryPatterns</code> to the beginning and <code>isDeleted</code> statement patterns to the end of the WHERE clause. </p>
<ul>
<li><code>ConstructToSelectTransformer</code> (extends <code>WhereTransformer</code>): instructions how to turn a Construct query into a Select query (converts a Gravsearch query into a prequery)</li>
<li><code>SelectToSelectTransformer</code> (extends <code>WhereTransformer</code>): instructions how to turn a triplestore independent Select query into a triplestore dependent Select query (implementation of inference).    </li>
<li><code>ConstructToConstructTransformer</code> (extends <code>WhereTransformer</code>): instructions how to turn a triplestore independent Construct query into a triplestore dependent Construct query (implementation of inference).</li>
</ul>
<p>The traits listed above define methods that are implemented in the transformer classes and called by <code>QueryTraverser</code> to perform SPARQL to SPARQL conversions.
When iterating over the statements of the input query, the transformer class's transformation methods are called to perform the conversion.</p>
<h3 id="prequery">Prequery</h3>
<p>The purpose of the prequery is to get an ordered collection of results representing only the IRIs of one page of matching resources and values.
Sort criteria can be submitted by the user, but the result is always deterministic also without sort criteria.
This is necessary to support paging.
A prequery is a SPARQL SELECT query.</p>
<p>The classes involved in generating prequeries can be found in <code>org.knora.webapi.messages.util.search.gravsearch.prequery</code>.</p>
<p>If the client submits a count query, the prequery returns the overall number of hits, but not the results themselves.</p>
<p>In a first step, before transforming the WHERE clause, query patterns must be further optimised by removing
the <code>rdfs:type</code> statement for entities whose type could be inferred from their use with a property IRI, since there would be no need 
for explicit <code>rdfs:type</code> statements for them (unless the property IRI from which the type of an entity must be inferred from 
is wrapped in an <code>OPTIONAL</code> block). This optimisation takes the Gravsearch query as input (rather than the generated SPARQL),
because it uses type information that refers to entities in the Gravsearch query, and the generated SPARQL might
have different entities.</p>
<p>Next, the Gravsearch query's WHERE clause is transformed and the prequery (SELECT and WHERE clause) is generated from this result.
The transformation of the Gravsearch query's WHERE clause relies on the implementation of the abstract class <code>AbstractPrequeryGenerator</code>.</p>
<p><code>AbstractPrequeryGenerator</code> contains members whose state is changed during the iteration over the statements of the input query.
They can then by used to create the converted query.</p>
<ul>
<li><code>mainResourceVariable: Option[QueryVariable]</code>: SPARQL variable representing the main resource of the input query. Present in the prequery's SELECT clause.</li>
<li><code>dependentResourceVariables: mutable.Set[QueryVariable]</code>: a set of SPARQL variables representing dependent resources in the input query. Used in an aggregation function in the prequery's SELECT clause (see below).</li>
<li><code>dependentResourceVariablesGroupConcat: Set[QueryVariable]</code>: a set of SPARQL variables representing an aggregation of dependent resources. Present in the prequery's SELECT clause.</li>
<li><code>valueObjectVariables: mutable.Set[QueryVariable]</code>: a set of SPARQL variables representing value objects. Used in an aggregation function in the prequery's SELECT clause (see below).</li>
<li><code>valueObjectVarsGroupConcat: Set[QueryVariable]</code>: a set of SPARQL variables representing an aggregation of value objects. Present in the prequery's SELECT clause.</li>
</ul>
<p>The variables mentioned above are present in the prequery's result rows because they are part of the prequery's SELECT clause.</p>
<p>The following example illustrates the handling of variables.
The following Gravsearch query looks for pages with a sequence number of 10 that are part of a book:</p>
<pre><code class="language-sparql">PREFIX incunabula: &lt;http://0.0.0.0:3333/ontology/0803/incunabula/simple/v2#&gt;
PREFIX knora-api: &lt;http://api.knora.org/ontology/knora-api/simple/v2#&gt;

    CONSTRUCT {
        ?page knora-api:isMainResource true .

        ?page knora-api:isPartOf ?book .

        ?page incunabula:seqnum ?seqnum .
    } WHERE {

        ?page a incunabula:page .

        ?page knora-api:isPartOf ?book .

        ?book a incunabula:book .

        ?page incunabula:seqnum ?seqnum .

        FILTER(?seqnum = 10)

    }
</code></pre>
<p>The prequery's SELECT clause is built by
<code>NonTriplestoreSpecificGravsearchToPrequeryTransformer.getSelectColumns</code>,
based on the variables used in the input query's <code>CONSTRUCT</code> clause.
The resulting SELECT clause looks as follows:</p>
<pre><code class="language-sparql">SELECT DISTINCT
    ?page
    (GROUP_CONCAT(DISTINCT(IF(BOUND(?book), STR(?book), &quot;&quot;)); SEPARATOR='') AS ?book__Concat)
    (GROUP_CONCAT(DISTINCT(IF(BOUND(?seqnum), STR(?seqnum), &quot;&quot;)); SEPARATOR='') AS ?seqnum__Concat)
    (GROUP_CONCAT(DISTINCT(IF(BOUND(?book__LinkValue), STR(?book__LinkValue), &quot;&quot;)); SEPARATOR='') AS ?book__LinkValue__Concat)
    WHERE {...}
    GROUP BY ?page
    ORDER BY ASC(?page)
    LIMIT 25
</code></pre>
<p><code>?page</code> represents the main resource. When accessing the prequery's result rows, <code>?page</code> contains the IRI of the main resource.
The prequery's results are grouped by the main resource so that there is exactly one result row per matching main resource.
<code>?page</code> is also used as a sort criterion although none has been defined in the input query.
This is necessary to make paging work: results always have to be returned in the same order (the prequery is always deterministic).
Like this, results can be fetched page by page using LIMIT and OFFSET.</p>
<p>Grouping by main resource requires other results to be aggregated using the function <code>GROUP_CONCAT</code>.
<code>?book</code> is used as an argument of the aggregation function.
The aggregation's result is accessible in the prequery's result rows as <code>?book__Concat</code>.
The variable <code>?book</code> is bound to an IRI.
Since more than one IRI could be bound to a variable representing a dependent resource, the results have to be aggregated.
<code>GROUP_CONCAT</code> takes two arguments: a collection of strings (IRIs in our use case) and a separator
(we use the non-printing Unicode character <code>INFORMATION SEPARATOR ONE</code>).
When accessing <code>?book__Concat</code> in the prequery's results containing the IRIs of dependent resources, the string has to be split with the separator used in the aggregation function.
The result is a collection of IRIs representing dependent resources.
The same logic applies to value objects.</p>
<p>Each <code>GROUP_CONCAT</code> checks whether the concatenated variable is bound in each result in the group; if a variable
is unbound, we concatenate an empty string. This is necessary because, in Apache Jena (and perhaps other
triplestores), "If <code>GROUP_CONCAT</code> has an unbound value in the list of values to concat, the overall result is 'error'"
(see <a href="https://issues.apache.org/jira/browse/JENA-1856">this Jena issue</a>).</p>
<p>If the input query contains a <code>UNION</code>, and a variable is bound in one branch
of the <code>UNION</code> and not in another branch, it is possible that the prequery
will return more than one row per main resource. To deal with this situation,
<code>SearchResponderV2</code> merges rows that contain the same main resource IRI.</p>
<h3 id="main-query">Main Query</h3>
<p>The purpose of the main query is to get all requested information about the main resource, dependent resources, and value objects.
The IRIs of those resources and value objects were returned by the prequery.
Since the prequery only returns resources and value objects matching the input query's criteria,
the main query can specifically ask for more detailed information on these resources and values without having to reconsider these criteria.</p>
<h4 id="generating-the-main-query">Generating the Main Query</h4>
<p>The classes involved in generating the main query can be found in
<code>org.knora.webapi.messages.util.search.gravsearch.mainquery</code>.</p>
<p>The main query is a SPARQL CONSTRUCT query. Its generation is handled by the
method <code>GravsearchMainQueryGenerator.createMainQuery</code>.
It takes three arguments:
<code>mainResourceIris: Set[IriRef], dependentResourceIris: Set[IriRef], valueObjectIris: Set[IRI]</code>.</p>
<p>These sets are constructed based on information about variables representing
dependent resources and value objects in the prequery, which is provided by
<code>NonTriplestoreSpecificGravsearchToPrequeryTransformer</code>:</p>
<ul>
<li><code>dependentResourceVariablesGroupConcat</code>: <code>Set(QueryVariable(book__Concat))</code></li>
<li><code>valueObjectVariablesGroupConcat</code>: <code>Set(QueryVariable(seqnum__Concat), QueryVariable(book__LinkValue__Concat))</code></li>
</ul>
<p>From the given Iris, statements are
generated that ask for complete information on <em>exactly</em> these resources and
values. For any given resource Iri, only the values present in
<code>valueObjectIris</code> are to be queried. This is achieved by using SPARQL's
<code>VALUES</code> expression for the main resource and dependent resources as well as
for values.</p>
<h4 id="processing-the-main-querys-results">Processing the Main Query's results</h4>
<p>To do the permission checking, the results of the main query are passed to
<code>ConstructResponseUtilV2.splitMainResourcesAndValueRdfData</code>,
which transforms a <code>SparqlConstructResponse</code> (a set of RDF triples)
into a structure organized by main resource Iris. In this structure, dependent
resources and values are nested and can be accessed via their main resource,
and resources and values that the user does not have permission to see are
filtered out. As a result, a page of results may contain fewer than the maximum
allowed number of results per page, even if more pages of results are available.</p>
<p><code>MainQueryResultProcessor.getRequestedValuesFromResultsWithFullGraphPattern</code>
then filters out values that the user did not explicitly ask for in the input
query.</p>
<p>Finally, <code>ConstructResponseUtilV2.createApiResponse</code> transforms the query
results into an API response (a <code>ReadResourcesSequenceV2</code>). If the number
of main resources found (even if filtered out because of permissions) is equal
to the maximum allowed page size, the predicate
<code>knora-api:mayHaveMoreResults: true</code> is included in the response.</p>
<h2 id="inference">Inference</h2>
<p>Gravsearch queries support a subset of RDFS reasoning
(see <a href="../../../../03-apis/api-v2/query-language/#inference">Inference</a> in the API documentation
on Gravsearch). This is implemented as follows:</p>
<p>When the non-triplestore-specific version of a SPARQL query is generated, statements that do not need
inference are marked with the virtual named graph <code>&lt;http://www.knora.org/explicit&gt;</code>.</p>
<p>When the triplestore-specific version of the query is generated:</p>
<ul>
<li>
<p>If the triplestore is GraphDB, <code>SparqlTransformer.transformKnoraExplicitToGraphDBExplicit</code> changes statements
  with the virtual graph <code>&lt;http://www.knora.org/explicit&gt;</code> so that they are marked with the GraphDB-specific graph
  <code>&lt;http://www.ontotext.com/explicit&gt;</code>, and leaves other statements unchanged. 
  <code>SparqlTransformer.transformKnoraExplicitToGraphDBExplicit</code> also adds the <code>valueHasString</code> statements which GraphDB needs 
  for text searches.</p>
</li>
<li>
<p>If Knora is not using the triplestore's inference (e.g. with Fuseki),
  <code>SparqlTransformer.transformStatementInWhereForNoInference</code> removes <code>&lt;http://www.knora.org/explicit&gt;</code>, and expands unmarked
  statements using <code>rdfs:subClassOf*</code> and <code>rdfs:subPropertyOf*</code>.</p>
</li>
</ul>
<p>Gravsearch also provides some virtual properties, which take advantage of forward-chaining inference
as an optimisation if the triplestore provides it. For example, the virtual property
<code>knora-api:standoffTagHasStartAncestor</code> is equivalent to <code>knora-base:standoffTagHasStartParent*</code>, but
with GraphDB it is implemented using a custom inference rule (in <code>KnoraRules.pie</code>) and is therefore more
efficient. If Knora is not using the triplestore's inference, <code>SparqlTransformer.transformStatementInWhereForNoInference</code>
replaces <code>knora-api:standoffTagHasStartAncestor</code> with <code>knora-base:standoffTagHasStartParent*</code>.</p>
<h1 id="optimisation-of-generated-sparql">Optimisation of generated SPARQL</h1>
<p>The triplestore-specific transformers in <code>SparqlTransformer.scala</code> can run optimisations on the generated SPARQL, in
the method <code>optimiseQueryPatterns</code> inherited from <code>WhereTransformer</code>. For example, <code>moveLuceneToBeginning</code> moves
Lucene queries to the beginning of the block in which they occur.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../sipi/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Knora and Sipi
              </div>
            </div>
          </a>
        
        
          <a href="../standoff/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Standoff Markup
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.b3a72adc.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: ['navigation.tabs'],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>